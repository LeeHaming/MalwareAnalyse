#encoding:utf-8
"""
MalwareAnalyse\getAPKs
written by leeham
"""

import re
import urllib
import os
#response=urllib.urlopen('http://zhushou.360.cn/list/index/cid/1?page=1')
#html=response.read()
#link_list=re.findall(r"(?<=&url=).*?apk",html)
#for url in link_list:
 #    print url
class testClass:
    def __init__(self):
        self.urllist=[]
        self.k=180
        self.baseurl='http://zhushou.360.cn/list/index/cid/1?page='
    def geturl(self,pageindex):
        for i in range(1,pageindex+1):
            self.urllist.append(self.baseurl+str(i))
        print(self.urllist)
    def spider(self):
        for i in range(len(self.urllist)):
            print(self.urllist[i])
            response=urllib.urlopen(self.urllist[i])
            html=response.read()
            link_list=re.findall(r"(?<=&url=).*?apk",html)
            for url in link_list:
                file_name="%d.apk"%(self.k)
                print(file_name)
                self.k=self.k+1
                file_path=os.path.join("E:\\study\\APK\\",file_name)
                urllib.urlretrieve(url,file_path)
            #del self.urllist[0]
            print(i)
    def start(self):
        self.geturl(50)
        self.spider()
        
a=testClass()
a.start()