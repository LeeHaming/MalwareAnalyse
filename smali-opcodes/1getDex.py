# coding = utf-8
import os
import zipfile

path="E:\MalwareAnalyse\APK\\"
dex_path="./dest"
i=0

#apklist=os.listdir(path)

if not os.path.exists(dex_path):
	os.makedirs(dex_path)

for dir in os.walk(path):
		i+=1

		if i==1:
			continue
		print(dir[0])
		#for APK in apklist:
		
		for APK in dir[2]:
			if APK.endswith(".apk"):
				#print(APK)
				portion=os.path.splitext(APK)
				#print(portion)

				if portion[1]==".apk":
					newname=portion[0]+".zip"
					print(newname)
					os.rename(os.path.join(dir[0],APK),os.path.join(dir[0],newname))
					print(newname)
				if newname.endswith(".zip"):
					try:
						#print("1")
						apkname=portion[0]
						zip_apk_path=os.path.join(dir[0],newname)
						#print(zip_apk_path)
						z=zipfile.ZipFile(zip_apk_path,"r")
						#print(z.namelist())

						for filename in z.namelist():
							if filename.endswith(".dex"):
								#print(filename)
								dexfilename=apkname+".dex"
								dexfilepath=os.path.join(dex_path,dexfilename)
								#print(dexfilepath)
								f=open(dexfilepath,"wb")
								#print(z.read(filename))
								#print(zip_apk_path+filename)
								#src=open(zip_apk_path+'\\'+filename,"r")
								f.write(z.read(filename))

					except Exception:
						continue
					finally:
						print("error for BadZipFile!!!!!!!!!!!!!!!!!!!!!!!!!111")
						
print("all work done")