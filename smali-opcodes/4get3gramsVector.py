#coding:utf-8

from collections import *
import os

allOpcode=['M','R','G','I','T','P','V']
all3Grams=set()
for first in allOpcode:
	for second in allOpcode:
		for third in allOpcode:
			all3Grams.add(tuple([first,second,third]))

#all3Grams=list(all3Grams)
print(len(all3Grams))


path="C:/users/lenovo/Desktop/tmp"
files=os.listdir(path)

sampleOpFeature=open("sampleOpFeature.txt","w")

for file in files:
	if file.endswith(".txt"):
		oplist=[]

		with open(file) as opFile:
			lines=opFile.readlines();
			for line in lines:
				if(line.startswith('move')):
					oplist.append('M')
				elif(line.startswith('return')):
					oplist.append('R')
				elif(line.startswith('goto')):
					oplist.append('G')
				elif(line.startswith('if-')):
					oplist.append('I')
				elif(line.startswith('aget') or line.startswith('iget') or line.startswith('sget')):
					oplist.append('T')
				elif(line.startswith('aput') or line.startswith('iput') or line.startswith('sput')):
					oplist.append('P')
				elif(line.startswith('invoke-')):
					oplist.append('V')
				else:
					continue
		#print(oplist)

		opngramlist=[tuple(oplist[i:i+3]) for i in range(len(oplist)-3)]
		opngram=Counter(opngramlist)
		#print(opngram)

		vector={}
		opVector=[]
		for gram in all3Grams:
			if gram in opngram:
				vector[gram]=opngram[gram]
				opVector.append(vector[gram])
			else:
				vector[gram]=0
				opVector.append(vector[gram])
		print("---------------------"+file+"-----------------------------")
		print(vector.values())
		print(opVector)

		sampleOpFeature.write(file)
		for item in opVector:
			sampleOpFeature.write('\t'+str(item))
		sampleOpFeature.write('\n')
